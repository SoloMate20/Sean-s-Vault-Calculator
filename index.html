
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Vault NewsCast Studio - Calculator</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme:{extend:{colors:{
        'brand-bg-dark':'#013a33',
        'brand-card-bg':'#024c42',
        'brand-yellow' :'#f0c555',
        'brand-text'   :'#bbc9cc',
        'brand-muted'  :'#69aca3'
    }}}}
  </script>

  <!-- React UMD + Babel -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- field styling -->
  <style>
    .input-label{font-weight:700;color:#f0c555;margin-bottom:.4rem;display:block}
    .input-field{
      background:#024c42;border:1px solid #f0c555;border-radius:.75rem;
      padding:.75rem 1rem;font-weight:600;font-size:1rem;color:#bbc9cc;width:100%
    }
    select.input-field{
      appearance:none;
      background-image:url("data:image/svg+xml;utf8,<svg fill='%23f0c555' height='20' viewBox='0 0 24 24' width='20' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5H7z'/></svg>");
      background-repeat:no-repeat;background-position:right .9rem center;padding-right:2.2rem
    }
    .badge {
      display: inline-block;
      padding: 0.25rem 0.5rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: bold;
      text-transform: uppercase;
      background: rgba(240, 197, 85, 0.1);
      border: 1px solid rgba(240, 197, 85, 0.3);
      color: #f0c555;
    }
    canvas {
      max-height: 350px;
    }
  </style>
</head>

<body class="bg-brand-bg-dark text-brand-text min-h-screen flex flex-col p-6">

  <!-- live price banner -->
  <div class="text-center mb-8">
    <div id="price-banner" class="inline-block bg-brand-card-bg border border-brand-yellow/50 rounded-full px-6 py-2 text-brand-yellow text-lg font-semibold shadow-md">
      Loading live price…
    </div>
  </div>

  <div id="app" class="max-w-3xl mx-auto flex-grow"></div>

  <footer class="max-w-3xl mx-auto mt-10 text-center text-xs text-brand-muted leading-snug">
    Disclaimer: This tool uses a daily accrual model with monthly compounding (30-day cycle).<br>
    A 25% performance fee is deducted from gross monthly earnings before compounding.
  </footer>

  <script type="text/babel">
  const {useState, useEffect, useRef}=React;
  const USD=v=>v.toLocaleString('en-US',{style:'currency',currency:'USD'});
  const GBP=v=>v.toLocaleString('en-GB',{style:'currency',currency:'GBP'});
  const EUR=v=>v.toLocaleString('de-DE',{style:'currency',currency:'EUR'});
  const fetchJSON=u=>fetch(u).then(r=>{if(!r.ok)throw Error(r.statusText);return r.json()});

  function GrowthChart({ data, currencySymbol }) {
    const canvasRef = useRef(null);
    const chartRef = useRef(null);

    useEffect(() => {
      if (!canvasRef.current || !data) return;

      const ctx = canvasRef.current.getContext('2d');
      
      if (chartRef.current) {
        chartRef.current.destroy();
      }

      const labels = data.map(d => `M${d.m}`);
      const balanceData = data.map(d => d.end);
      const netAddedData = data.map(d => d.netAdded);

      chartRef.current = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [
            {
              label: 'Net Monthly Earnings',
              data: netAddedData,
              backgroundColor: 'rgba(34, 197, 94, 0.4)',
              borderColor: 'rgba(34, 197, 94, 1)',
              borderWidth: 1,
              borderRadius: 4,
              yAxisID: 'y1',
              order: 2
            },
            {
              label: 'Principal Growth',
              data: balanceData,
              type: 'line',
              borderColor: '#f0c555',
              backgroundColor: 'rgba(240, 197, 85, 0.1)',
              borderWidth: 3,
              pointRadius: 4,
              pointBackgroundColor: '#f0c555',
              fill: true,
              tension: 0.4,
              yAxisID: 'y',
              order: 1
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: {
            mode: 'index',
            intersect: false,
          },
          plugins: {
            legend: {
              display: true,
              position: 'top',
              labels: { color: '#bbc9cc', font: { weight: 'bold' } }
            },
            tooltip: {
              backgroundColor: '#024c42',
              titleColor: '#f0c555',
              bodyColor: '#fff',
              borderColor: '#f0c555',
              borderWidth: 1
            }
          },
          scales: {
            y: {
              type: 'linear',
              display: true,
              position: 'left',
              grid: { color: 'rgba(105, 172, 163, 0.1)' },
              ticks: { color: '#69aca3' },
              title: { display: true, text: 'Total Balance', color: '#f0c555' }
            },
            y1: {
              type: 'linear',
              display: true,
              position: 'right',
              grid: { drawOnChartArea: false },
              ticks: { color: '#69aca3' },
              title: { display: true, text: 'Monthly Net', color: '#22c55e' }
            },
            x: {
              grid: { display: false },
              ticks: { color: '#69aca3' }
            }
          }
        }
      });

      return () => {
        if (chartRef.current) chartRef.current.destroy();
      };
    }, [data, currencySymbol]);

    return (
      <div className="w-full bg-brand-bg-dark/30 p-4 rounded-xl border border-white/5 mt-4">
        <canvas ref={canvasRef}></canvas>
      </div>
    );
  }

  function App(){
    /* inputs */
    const [cryptoId] = useState('solana');
    const [init,setInit]=useState(1000);
    const [daily,setDaily]=useState(0.01);
    const [months,setMonths]=useState(12);
    const [ccy,setCcy]=useState('USD');

    /* market */
    const [cryptoPrice, setCryptoPrice]=useState(null);
    const [gbp,setGbp]=useState(null);
    const [eur,setEur]=useState(null);

    const [res,setRes]=useState(null);
    const cryptoSymbol = cryptoId ? cryptoId.toUpperCase() : '';

    /* fetch prices once */
    useEffect(()=>{
      if (!cryptoId) {
        document.getElementById('price-banner').textContent = 'Please enter a valid Crypto ID';
        setCryptoPrice(null);
        return;
      };

      Promise.all([
        fetchJSON(`https://api.coingecko.com/api/v3/simple/price?ids=${cryptoId.toLowerCase()}&vs_currencies=usd`),
        fetchJSON('https://api.exchangerate-api.com/v4/latest/USD')
      ])
      .then(([sp,fx])=>{
        const priceData = sp[cryptoId.toLowerCase()];
        if (priceData && priceData.usd) {
          setCryptoPrice(priceData.usd);
          document.getElementById('price-banner').textContent =
            `Live ${cryptoSymbol} Price: ${USD(priceData.usd)}`;
        } else {
          setCryptoPrice(null);
          document.getElementById('price-banner').textContent =
            `Price for ${cryptoSymbol} unavailable`;
        }
        setGbp(fx.rates.GBP);
        setEur(fx.rates.EUR);
      })
      .catch(()=>{
        setCryptoPrice(null);
        document.getElementById('price-banner').textContent =
        `Live ${cryptoSymbol} price unavailable`;
      });
    },[cryptoId]);

    /* Updated calculation logic: Daily Accrual / Monthly Compounding */
    useEffect(()=>{
      if(!cryptoPrice||!gbp||!eur) {
        setRes(null);
        return;
      };

      const principal = parseFloat(init);
      const dailyYield = parseFloat(daily);
      const durationMonths = parseInt(months, 10);
      const feeRate = 0.25; // Fixed 25% performance fee

      if (isNaN(principal) || isNaN(dailyYield) || isNaN(durationMonths) || durationMonths <= 0 || principal <= 0) {
        setRes(null);
        return;
      }

      let currentBalance = principal;
      const monthlyBreakdown = [];
      const daysInCycle = 30; // 30-day period as per instructions

      for (let m = 1; m <= durationMonths; m++) {
        const startOfMonthBalance = currentBalance;
        
        // 1. Daily Accrual (Simple interest applied to the month's starting principal)
        const dailyEarning = startOfMonthBalance * dailyYield;
        const grossMonthlyEarnings = dailyEarning * daysInCycle;

        // 2. Monthly Compounding & Fee Deduction
        const performanceFee = grossMonthlyEarnings * feeRate;
        const netAddedToPrincipal = grossMonthlyEarnings - performanceFee;
        
        // 3. Reset daily counter & Update Principal for next month
        currentBalance = startOfMonthBalance + netAddedToPrincipal;
        
        monthlyBreakdown.push({
          m: m,
          start: startOfMonthBalance,
          grossEarnings: grossMonthlyEarnings,
          fee: performanceFee,
          netAdded: netAddedToPrincipal,
          end: currentBalance,
        });
      }

      const totalGross = monthlyBreakdown.reduce((sum, row) => sum + row.grossEarnings, 0);
      const totalFees = monthlyBreakdown.reduce((sum, row) => sum + row.fee, 0);
      
      setRes({
        final: currentBalance,
        totalGross: totalGross,
        totalFees: totalFees,
        rows: monthlyBreakdown,
      });

    },[init, daily, months, cryptoPrice, gbp, eur]);

    const fmt = v => {
      if (ccy === 'GBP') return GBP(v);
      if (ccy === 'EUR') return EUR(v);
      if (ccy === cryptoSymbol) return v.toFixed(4) + ' ' + cryptoSymbol;
      return USD(v); // Default is USD
    };

    const renderCell = (value) => {
      if (ccy !== cryptoSymbol || !cryptoPrice) {
        return fmt(value);
      }
      return (
        <React.Fragment>
          <div>{fmt(value)}</div>
          <div className="text-[10px] text-brand-muted">{USD(value * cryptoPrice)}</div>
        </React.Fragment>
      );
    };

    return (
      <div className="space-y-10">
        <div className="text-center">
          <h1 className="text-4xl sm:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-brand-yellow to-yellow-300 tracking-wide">Vault Accrual Estimator</h1>
          <p className="text-brand-muted text-lg -mt-1">Performance-Adjusted Daily Accrual Logic</p>
          
          <div className="mt-6 max-w-xl mx-auto bg-brand-yellow/5 border border-brand-yellow/20 rounded-xl p-4 text-xs sm:text-sm text-brand-yellow/90 italic leading-relaxed shadow-inner">
            <span className="font-bold not-italic block mb-1 underline">IMPORTANT NOTE</span>
            Note, the financial calculations are based on the current Solana price. The price may go up as well as down. This calculator represents the High Yield Calculation (Monthly Compounding).
          </div>
        </div>

        <section className="bg-brand-card-bg rounded-2xl p-8 grid gap-x-8 gap-y-6 sm:grid-cols-2 shadow-xl border border-brand-yellow/10">
          <div>
            <label className="input-label">Initial Principal</label>
            <input type="number" className="input-field" value={init} onChange={e=>setInit(e.target.value)}/>
            {ccy === cryptoSymbol && cryptoPrice && parseFloat(init) > 0 && (
              <p className="text-xs text-brand-muted mt-2 text-right">
                ≈ {USD(parseFloat(init) * cryptoPrice)}
              </p>
            )}
          </div>
          <div>
            <label className="input-label">Display Currency</label>
            <select className="input-field" value={ccy} onChange={e=>setCcy(e.target.value)}>
              <option>USD</option><option>GBP</option><option>EUR</option><option>{cryptoSymbol}</option>
            </select>
          </div>
          <div>
            <label className="input-label">Average Daily Yield (%)</label>
            <select className="input-field" value={daily} onChange={e=>setDaily(Number(e.target.value))}>
              <option value={0.0025}>0.25 % Daily</option>
              <option value={0.005}>0.5 % Daily</option>
              <option value={0.0075}>0.75 % Daily</option>
              <option value={0.01}>1.0 % Daily</option>
              <option value={0.0125}>1.25 % Daily</option>
              <option value={0.015}>1.5 % Daily</option>
              <option value={0.02}>2.0 % Daily</option>
            </select>
          </div>
          <div>
            <label className="input-label">Duration (months)</label>
            <input type="number" className="input-field" value={months} onChange={e=>setMonths(e.target.value)}/>
          </div>
        </section>

        {res && cryptoPrice && (
          <section className="bg-brand-card-bg rounded-2xl p-8 space-y-6 text-brand-text shadow-2xl border-t-4 border-brand-yellow relative overflow-hidden">
            <div className="absolute top-4 right-4 flex flex-col items-end gap-2">
               <span className="badge">Monthly Compounding</span>
               <span className="badge">25% Fee Applied</span>
            </div>
            
            <h2 className="text-2xl font-bold text-brand-yellow">Projected Summary</h2>
            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
              <div className="bg-brand-bg-dark/50 p-4 rounded-xl border border-white/5">
                <p className="text-xs text-brand-muted uppercase font-bold mb-1">Final Balance</p>
                <p className="text-2xl font-black text-white">{fmt(res.final)}</p>
              </div>
              <div className="bg-brand-bg-dark/50 p-4 rounded-xl border border-white/5">
                <p className="text-xs text-brand-muted uppercase font-bold mb-1">Gross Yield</p>
                <p className="text-xl font-bold text-brand-yellow">{fmt(res.totalGross)}</p>
              </div>
              <div className="bg-brand-bg-dark/50 p-4 rounded-xl border border-white/5">
                <p className="text-xs text-brand-muted uppercase font-bold mb-1">Total Fees</p>
                <p className="text-xl font-bold text-red-400">{fmt(res.totalFees)}</p>
              </div>
            </div>

            <GrowthChart data={res.rows} currencySymbol={ccy} />

            <details className="mt-8 group">
              <summary className="underline cursor-pointer text-brand-text hover:text-brand-yellow font-medium list-none flex items-center gap-2">
                <span className="group-open:rotate-90 transition-transform">▶</span> Monthly Accrual Breakdown
              </summary>
              <div className="overflow-x-auto">
                <table className="w-full text-sm mt-4 text-left border-collapse">
                  <thead>
                    <tr className="border-b border-brand-muted/30 text-brand-yellow text-xs uppercase tracking-wider">
                      <th className="py-3 px-2">Month</th>
                      <th className="py-3 px-2">Principal</th>
                      <th className="py-3 px-2">Gross Earned</th>
                      <th className="py-3 px-2">Fee (25%)</th>
                      <th className="py-3 px-2">Net Added</th>
                      <th className="py-3 px-2">End Principal</th>
                    </tr>
                  </thead>
                  <tbody>
                    {res.rows.map(r=>(
                      <tr key={r.m} className="border-b border-brand-muted/10 hover:bg-brand-bg-dark/30 transition-colors">
                        <td className="py-3 px-2 font-bold">{r.m}</td>
                        <td className="py-3 px-2">{renderCell(r.start)}</td>
                        <td className="py-3 px-2 text-brand-yellow">{renderCell(r.grossEarnings)}</td>
                        <td className="py-3 px-2 text-red-300/80">{renderCell(r.fee)}</td>
                        <td className="py-3 px-2 text-green-400">{renderCell(r.netAdded)}</td>
                        <td className="py-3 px-2 font-semibold text-white">{renderCell(r.end)}</td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            </details>
          </section>
        )}
      </div>
    );
  }

  ReactDOM.createRoot(document.getElementById('app')).render(<App/>);
  </script>
</body>
</html>
