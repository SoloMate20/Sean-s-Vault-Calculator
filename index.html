<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Vault Calculator</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme:{extend:{colors:{
        'brand-bg-dark':'#013a33',
        'brand-card-bg':'#024c42',
        'brand-yellow' :'#f0c555',
        'brand-text'   :'#bbc9cc',
        'brand-muted'  :'#69aca3'
    }}}}
  </script>

  <!-- React UMD + Babel -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

  <!-- field styling -->
  <style>
    .input-label{font-weight:700;color:#f0c555;margin-bottom:.4rem;display:block}
    .input-field{
      background:#024c42;border:1px solid #f0c555;border-radius:.75rem;
      padding:.75rem 1rem;font-weight:600;font-size:1rem;color:#bbc9cc;width:100%
    }
    select.input-field{
      appearance:none;
      background-image:url("data:image/svg+xml;utf8,<svg fill='%23f0c555' height='20' viewBox='0 0 24 24' width='20' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5H7z'/></svg>");
      background-repeat:no-repeat;background-position:right .9rem center;padding-right:2.2rem
    }
  </style>
</head>

<body class="bg-brand-muted text-brand-bg-dark min-h-screen flex flex-col p-6">

  <!-- live price banner -->
  <div class="text-center mb-8">
    <div id="price-banner" class="inline-block bg-brand-card-bg border border-brand-yellow/50 rounded-full px-6 py-2 text-brand-yellow text-lg font-semibold shadow-md">
      Loading live price…
    </div>
  </div>

  <div id="app" class="max-w-3xl mx-auto flex-grow"></div>

  <footer class="max-w-3xl mx-auto mt-10 text-center text-xs text-brand-bg-dark/70 leading-snug">
    Disclaimer: This tool is for illustrative purposes only and does not constitute financial advice.<br>
    Crypto Market prices, yields, and exchange rates are volatile. Always do your own research and only invest what you can afford to.
  </footer>

  <script type="text/babel">
  const {useState,useEffect}=React;
  const USD=v=>v.toLocaleString('en-US',{style:'currency',currency:'USD'});
  const GBP=v=>v.toLocaleString('en-GB',{style:'currency',currency:'GBP'});
  const EUR=v=>v.toLocaleString('de-DE',{style:'currency',currency:'EUR'});
  const fetchJSON=u=>fetch(u).then(r=>{if(!r.ok)throw Error(r.statusText);return r.json()});

  function App(){
    /* inputs */
    const [cryptoId] = useState('solana');
    const [init,setInit]=useState(1000);
    const [daily,setDaily]=useState(0.01);
    const [months,setMonths]=useState(12);
    const [feePct,setFee]=useState(25);
    const [ccy,setCcy]=useState('USD');
    const [compoundingPeriods, setCompoundingPeriods] = useState(20);

    /* market */
    const [cryptoPrice, setCryptoPrice]=useState(null);
    const [gbp,setGbp]=useState(null);
    const [eur,setEur]=useState(null);

    const [res,setRes]=useState(null);
    const cryptoSymbol = cryptoId ? cryptoId.toUpperCase() : '';

    /* fetch prices once */
    useEffect(()=>{
      if (!cryptoId) {
        document.getElementById('price-banner').textContent = 'Please enter a valid Crypto ID';
        setCryptoPrice(null);
        return;
      };

      Promise.all([
        fetchJSON(`https://api.coingecko.com/api/v3/simple/price?ids=${cryptoId.toLowerCase()}&vs_currencies=usd`),
        fetchJSON('https://api.exchangerate-api.com/v4/latest/USD')
      ])
      .then(([sp,fx])=>{
        const priceData = sp[cryptoId.toLowerCase()];
        if (priceData && priceData.usd) {
          setCryptoPrice(priceData.usd);
          document.getElementById('price-banner').textContent =
            `Live ${cryptoSymbol} Price: ${USD(priceData.usd)}`;
        } else {
          setCryptoPrice(null);
          document.getElementById('price-banner').textContent =
            `Price for ${cryptoSymbol} unavailable`;
        }
        setGbp(fx.rates.GBP);
        setEur(fx.rates.EUR);
      })
      .catch(()=>{
        setCryptoPrice(null);
        document.getElementById('price-banner').textContent =
        `Live ${cryptoSymbol} price unavailable`;
      });
    },[cryptoId]);

    /* calculation logic */
    useEffect(()=>{
      if(!cryptoPrice||!gbp||!eur) {
        setRes(null);
        return;
      };

      const principal = parseFloat(init);
      const dailyRate = parseFloat(daily);
      const durationMonths = parseInt(months, 10);
      const feeRate = parseFloat(feePct) / 100;

      if (isNaN(principal) || isNaN(dailyRate) || isNaN(durationMonths) || isNaN(feeRate) || durationMonths <= 0 || principal <= 0) {
        setRes(null);
        return;
      }

      let currentBalance = principal;
      const monthlyBreakdown = [];
      const daysInMonth = 30.4375; // Average days in a month

      for (let m = 1; m <= durationMonths; m++) {
        const startOfMonthBalance = currentBalance;
        
        // Treat daily rate as nominal and calculate monthly earnings based on compounding periods
        const nominalMonthlyRate = dailyRate * daysInMonth;
        const numPeriods = parseInt(compoundingPeriods, 10);
        const earningsForMonth = startOfMonthBalance * (Math.pow(1 + nominalMonthlyRate / numPeriods, numPeriods) - 1);

        const feeForMonth = earningsForMonth * feeRate;
        currentBalance = startOfMonthBalance + earningsForMonth - feeForMonth;
        
        monthlyBreakdown.push({
          m: m,
          start: startOfMonthBalance,
          earnings: earningsForMonth,
          perf: feeForMonth,
          end: currentBalance,
        });
      }

      const finalBalance = currentBalance;
      const totalGrossEarnings = monthlyBreakdown.reduce((sum, row) => sum + row.earnings, 0);
      const totalFees = monthlyBreakdown.reduce((sum, row) => sum + row.perf, 0);
      
      setRes({
        final: finalBalance,
        earnings: totalGrossEarnings,
        fees: totalFees,
        rows: monthlyBreakdown,
      });

    },[init,daily,months,feePct,compoundingPeriods,cryptoPrice,gbp,eur]);

    const fmt = v => {
      if (ccy === 'GBP') return GBP(v);
      if (ccy === 'EUR') return EUR(v);
      if (ccy === cryptoSymbol) return v.toFixed(4) + ' ' + cryptoSymbol;
      return USD(v); // Default is USD
    };

    const renderCell = (value) => {
      if (ccy !== cryptoSymbol || !cryptoPrice) {
        return fmt(value);
      }
      return (
        <React.Fragment>
          <div>{fmt(value)}</div>
          <div class="text-xs text-brand-text">{USD(value * cryptoPrice)}</div>
        </React.Fragment>
      );
    };

    return (
      <div class="space-y-10">
        <div class="text-center">
          <h1 class="text-4xl sm:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-brand-yellow to-yellow-300 tracking-wide">Vault Investment Calculator</h1>
          <p class="text-brand-bg-dark/70 text-lg -mt-1">Based on a {cryptoSymbol} Pairing</p>
        </div>

        <section class="bg-brand-card-bg rounded-xl p-8 grid gap-x-8 gap-y-6 sm:grid-cols-2">
          <div>
            <label class="input-label">Initial deposit</label>
            <input type="number" class="input-field" value={init} onChange={e=>setInit(e.target.value)}/>
            {ccy === cryptoSymbol && cryptoPrice && parseFloat(init) > 0 && (
              <p class="text-xs text-brand-muted mt-2 text-right">
                ≈ {USD(parseFloat(init) * cryptoPrice)}
              </p>
            )}
          </div>
          <div>
            <label class="input-label">Currency</label>
            <select class="input-field" value={ccy} onChange={e=>setCcy(e.target.value)}>
              <option>USD</option><option>GBP</option><option>EUR</option><option>{cryptoSymbol}</option>
            </select>
          </div>
          <div>
            <label class="input-label">Average Daily Earnings</label>
            <select class="input-field" value={daily} onChange={e=>setDaily(Number(e.target.value))}>
              <option value={0.005}>0.5 % per day</option>
              <option value={0.006}>0.6 % per day</option>
              <option value={0.007}>0.7 % per day</option>
              <option value={0.008}>0.8 % per day</option>
              <option value={0.009}>0.9 % per day</option>
              <option value={0.01}>1 % per day</option>
              <option value={0.011}>1.1 % per day</option>
              <option value={0.012}>1.2 % per day</option>
              <option value={0.013}>1.3 % per day</option>
              <option value={0.014}>1.4 % per day</option>
              <option value={0.015}>1.5 % per day</option>
            </select>
          </div>
          <div>
            <label class="input-label">Duration (months)</label>
            <input type="number" class="input-field" value={months} onChange={e=>setMonths(e.target.value)}/>
          </div>
          <div>
            <label class="input-label">Number of Days Compounding Per Month</label>
            <select class="input-field" value={compoundingPeriods} onChange={e=>setCompoundingPeriods(Number(e.target.value))}>
              {Array.from({ length: 30 }, (_, i) => i + 1).map(p => (
                <option key={p} value={p}>{p}</option>
              ))}
            </select>
          </div>
        </section>

        {res && cryptoPrice && (
          <section class="bg-brand-card-bg rounded-xl p-8 space-y-6 text-brand-text">
            <h2 class="text-xl font-semibold text-brand-yellow">Summary</h2>
            <p>Final balance: <strong>{fmt(res.final)}</strong></p>
            <p>Total earnings: {fmt(res.earnings)}</p>
            <p>Total fees: {fmt(res.fees)}</p>

            <details class="mt-4">
              <summary class="underline cursor-pointer text-brand-text hover:text-brand-yellow">Monthly breakdown</summary>
              <table class="w-full text-sm mt-3 text-center text-brand-text">
                <thead><tr class="border-b border-brand-muted/50"><th class="py-2">M</th><th>Start</th><th>Earn</th><th>Fee</th><th>End</th></tr></thead>
                <tbody>
                  {res.rows.map(r=>(
                    <tr key={r.m} class="border-b border-brand-muted/20">
                      <td class="py-2">{r.m}</td>
                      <td class="py-2">{renderCell(r.start)}</td>
                      <td class="py-2">{renderCell(r.earnings)}</td>
                      <td class="py-2">{renderCell(r.perf)}</td>
                      <td class="py-2">{renderCell(r.end)}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </details>
          </section>
        )}
      </div>
    );
  }

  ReactDOM.createRoot(document.getElementById('app')).render(<App/>);
  </script>
</body>
</html>